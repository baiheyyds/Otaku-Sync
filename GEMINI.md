# Otaku-Sync 项目概览

本文档旨在提供 Otaku-Sync 项目的整体架构、核心模块和关键设计的高层次概览，以指导和辅助 AI 进行开发与维护。

## 1. 核心目标

Otaku-Sync 是一款自动化工具，其核心目标是从多个在线数据源（如 DLsite, Fanza, GGBases, Bangumi）抓取游戏信息（尤其是 Galgame），并将其同步到一个结构化的 Notion 数据库中。项目同时支持图形用户界面（GUI）和命令行界面（CLI）两种操作模式。

## 2. 项目架构

本项目采用了一种将核心业务逻辑与用户界面完全解耦的设计，其实现依赖于 **“交互提供者” (Interaction Provider)** 设计模式。

- **`core/`**: 包含了所有的核心业务逻辑，如数据抓取、信息处理和同步。此模块与具体的 UI 实现无关。
- **`core/interaction.py`**: 定义了一个抽象接口，所有需要用户输入或交互的场景（例如，让用户从列表中选择、确认操作或输入文本）都必须通过此接口进行。
- **UI 实现**:
    - **GUI (`run_gui.py`, `gui/`, `utils/gui_bridge.py`)**: 通过一个基于 Qt (PySide6) 的现代化图形界面实现交互提供者接口。该界面采用了 `qdarkstyle` 库提供的暗色主题，并通过 `gui/style.qss` 进行自定义美化。主窗口使用标签页 (`QTabWidget`) 来组织不同的功能模块（如批处理工具、映射文件编辑器），布局则通过自定义的 `FlowLayout` 等组件实现，提供了用户友好的操作体验。
    - **CLI (`main.py`)**: 通过简单的命令行提示（如 `input()`）来实现交互提供者接口。

这种架构保证了项目的高度可维护性和可扩展性。例如，未来可以在不改动任何核心逻辑的情况下，轻松地为项目添加一个新的 Web 前端。

## 3. 主要入口点

- **`run_gui.py`**: **GUI 模式**的入口文件。它负责初始化 `QApplication`、应用 `qdarkstyle` 和自定义样式，并启动主窗口 `MainWindow`。这是为大多数用户推荐的运行方式。
- **`main.py`**: **CLI 模式**的入口文件。它包含一个主异步循环，负责提示用户输入、处理单个游戏，然后重复此过程。

## 4. 关键模块与目录

- **`clients/`**: 存放与特定网站（如 `DlsiteClient`, `BangumiClient`）交互的客户端。每个客户端封装了对应网站的搜索、抓取和解析逻辑。
- **`config/`**: 管理项目配置，包括 Notion 数据库的字段名 (`config_fields.py`) 和 API 令牌 (`config_token.py`，从 `.env` 文件读取)。
- **`core/`**: 项目的心脏。它负责编排从选择游戏到处理数据、再到同步至 Notion 的整个工作流程。
- **`gui/`**: 包含所有基于 Qt 的 UI 组件，如主窗口、对话框、自定义布局 (`FlowLayout`) 和自定义小部件。
- **`mapping/`**: 项目的灵魂所在，包含用于数据规范化和映射的 JSON 文件。这包括品牌名称的统一、标签的翻译以及同义词的合并。这些文件可由用户自定义，是保证数据一致性的关键。
- **`scripts/`**: 用于执行各种维护任务的实用脚本集合，例如数据清理、补全缺失信息或导出标签。
- **`utils/`**: 提供跨项目使用的共享工具，如日志记录、WebDriver 管理以及 GUI 与后端的桥接模块。

## 5. 开发原则

- **解耦**: 保持业务逻辑与 UI 分离。`core` 模块中所有需要用户交互的地方，都必须通过 `InteractionProvider` 接口。
- **异步优先**: 项目重度依赖 `asyncio`，以高效处理并发网络请求和其它耗时操作。
- **配置优于编码**: 在可能的情况下，优先使用配置文件（如 `mapping/` 目录下的文件）来实现用户自定义功能，而不是硬编码在代码中。
- **数据规范化**: 统一数据格式（如品牌、标签）是本项目的核心特性之一。在添加新功能时，应充分利用已有的映射管理器（`BrandMappingManager`, `TagManager`）来保持数据的一致性。